<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oxm="http://www.springframework.org/schema/oxm"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/oxm http://www.springframework.org/schema/oxm/spring-oxm-3.0.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">
    
    <description>Initialize a HTTP server for testing</description>
    
    <!-- Setup HTTP request and response for the test server -->
    <!-- Course API servlet -->
    <bean id="courseApiServlet" class="ca.ubc.ctlt.ipeerb2.webservice.ApiTestServlet">
        <property name="properties">
            <value>
                test_course.1.uri=/[^/]*/courses
                test_course.1.method=get
                test_course.1.responsebody=[{"id":1,"course":"MATH101","title":"Test Course"}, {"id":2,"course":"MATH102","title":"Test Course 2"},{"id":3,"course":"MATH103","title":"Test Course 3"}]
                test_course.1.responsestatus=200
           
                test_course.2.uri=/[^/]*/courses/1
                test_course.2.method=get
                test_course.2.responsebody={"id":1,"course":"MATH101","title":"Test Course"}
                test_course.2.responsestatus=200
                
                test_course.3.uri=/[^/]*/courses/999
                test_course.3.method=get
                test_course.3.responsebody={}
                test_course.3.responsestatus=404
                
                test_course.4.uri=/[^/]*/courses
                test_course.4.method=post
                test_course.4.requestbody={"id":0,"course":"MATH101","title":"Test Course"}
                test_course.4.responsebody={"id":1,"course":"MATH101","title":"Test Course"}
                test_course.4.responsestatus=201
                
                test_course.5.uri=/[^/]*/courses
                test_course.5.method=post
                test_course.5.requestbody={"id":0,"course":"MATH101","title":"Wrong Course"}
                test_course.5.responsestatus=500
                
                test_course.6.uri=/[^/]*/courses/1
                test_course.6.method=delete
                test_course.6.responsestatus=204
                
                test_course.7.uri=/[^/]*/courses/999
                test_course.7.method=delete
                test_course.7.responsestatus=500
                
                test_course.8.uri=/[^/]*/courses/1
                test_course.8.method=put
                test_course.8.requestbody={"id":1,"course":"MATH101","title":"Test Course"}
                test_course.8.responsestatus=200
                
                test_course.9.uri=/[^/]*/courses/999
                test_course.9.method=put
                test_course.9.requestbody={"id":999,"course":"MATH101","title":"Test Course"}
                test_course.9.responsestatus=500
                
                test_user.1.uri=/[^/]*/users
                test_user.1.method=get
                test_user.1.responsebody=[{"id":1,"role_id":1,"username":"username1","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":2,"role_id":1,"username":"username2","first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":3,"role_id":1,"username":"username3","first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_user.1.responsestatus=200
           
                test_user.2.uri=/[^/]*/users/1
                test_user.2.method=get
                test_user.2.responsebody={"id":1,"role_id":1,"username":"username1","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}
                test_user.2.responsestatus=200
                
                test_user.3.uri=/[^/]*/users/999
                test_user.3.method=get
                test_user.3.responsebody={}
                test_user.3.responsestatus=404
                
                test_user.4.uri=/[^/]*/users
                test_user.4.method=post
                test_user.4.requestbody={"id":0,"role_id":1,"username":"username1","password":"newpassword","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}
                test_user.4.responsebody={"id":1,"role_id":1,"username":"username1","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}
                test_user.4.responsestatus=201
                
                test_user.5.uri=/[^/]*/users
                test_user.5.method=post
                test_user.5.requestbody=[{"id":0,"role_id":1,"username":"username1","password":"newpassword","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":0,"role_id":1,"username":"username2","password":"newpassword","first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":0,"role_id":1,"username":"username3","password":"newpassword","first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_user.5.responsebody=[{"id":1,"role_id":1,"username":"username1","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":2,"role_id":1,"username":"username2","first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":3,"role_id":1,"username":"username3","first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_user.5.responsestatus=201
                
                test_user.6.uri=/[^/]*/users
                test_user.6.method=post
                test_user.6.requestbody={"id":0,"role_id":1,"username":"invalid_username","password":"newpassword","first_name":"Invalid","last_name":"User","email":"invalid_username@ubc.ca","student_id":"00000000"}
                test_user.6.responsestatus=500
                
                test_user.7.uri=/[^/]*/users/1
                test_user.7.method=delete
                test_user.7.responsestatus=204
                
                test_user.8.uri=/[^/]*/users/999
                test_user.8.method=delete
                test_user.8.responsestatus=500
                
                test_user.9.uri=/[^/]*/users/1
                test_user.9.method=put
                test_user.9.requestbody={"id":1,"role_id":1,"username":"username1","password":"newpassword","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}
                test_user.9.responsestatus=200
                
                test_user.10.uri=/[^/]*/users/999
                test_user.10.method=put
                test_user.10.requestbody={"id":999,"role_id":1,"username":"invalid_username","password":"newpassword","first_name":"Invalid","last_name":"User","email":"invalid_username@ubc.ca","student_id":"00000000"}
                test_user.10.responsestatus=500
                
                test_group.1.uri=/[^/]*/courses/\\d+/groups
                test_group.1.method=get
                test_group.1.responsebody=[{"id":1,"name":"groupname1","set_name":"Set1"}, {"id":2,"name":"groupname2","set_name":"Set1"},{"id":3,"name":"groupname3","set_name":"Set1"}]
                test_group.1.responsestatus=200
           
                test_group.2.uri=/[^/]*/courses/\\d+/groups/1
                test_group.2.method=get
                test_group.2.responsebody={"id":1,"name":"groupname1","set_name":"Set1"}
                test_group.2.responsestatus=200
                
                test_group.3.uri=/[^/]*/courses/\\d+/groups/999
                test_group.3.method=get
                test_group.3.responsebody={}
                test_group.3.responsestatus=404
                
                test_group.4.uri=/[^/]*/courses/\\d+/groups
                test_group.4.method=post
                test_group.4.requestbody={"id":0,"name":"groupname1","set_name":"Set1"}
                test_group.4.responsebody={"id":1,"name":"groupname1","set_name":"Set1"}
                test_group.4.responsestatus=201
                
                test_group.5.uri=/[^/]*/courses/\\d+/groups
                test_group.5.method=post
                test_group.5.requestbody=[{"id":0,"name":"groupname1","set_name":"Set1"},{"id":0,"name":"groupname2","set_name":"Set1"},{"id":0,"name":"groupname3","set_name":"Set1"}]
                test_group.5.responsebody=[{"id":1,"name":"groupname1","set_name":"Set1"},{"id":2,"name":"groupname2","set_name":"Set1"},{"id":3,"name":"groupname3","set_name":"Set1"}]
                test_group.5.responsestatus=201
                
                test_group.6.uri=/[^/]*/courses/\\d+/groups
                test_group.6.method=post
                test_group.6.requestbody={"id":0,"name":"invalid_groupname","set_name":"Set1"}
                test_group.6.responsestatus=500
                
                test_group.7.uri=/[^/]*/courses/\\d+/groups/1
                test_group.7.method=delete
                test_group.7.responsestatus=204
                
                test_group.8.uri=/[^/]*/courses/\\d+/groups/999
                test_group.8.method=delete
                test_group.8.responsestatus=500
                
                test_group.9.uri=/[^/]*/courses/\\d+/groups/1
                test_group.9.method=put
                test_group.9.requestbody={"id":1,"name":"groupname1","set_name":"Set1"}
                test_group.9.responsestatus=200
                
                test_group.10.uri=/[^/]*/courses/\\d+/groups/999
                test_group.10.method=put
                test_group.10.requestbody={"id":999,"name":"invalid_groupname","set_name":"Set1"}
                test_group.10.responsestatus=500
                
                test_course_user.1.uri=/[^/]*/courses/\\d+/users
                test_course_user.1.method=get
                test_course_user.1.responsebody=[{"id":1,"role_id":1,"username":"username1","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":2,"role_id":1,"username":"username2","first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":3,"role_id":1,"username":"username3","first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_course_user.1.responsestatus=200
                
                test_course_user.2.uri=/[^/]*/courses/999/users
                test_course_user.2.method=get
                test_course_user.2.responsestatus=500
                
                test_course_user.10.uri=/[^/]*/courses/\\d+/users
                test_course_user.10.method=post
                test_course_user.10.requestbody=[{"id":1,"role_id":1,"username":"username1","password":null,"first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":2,"role_id":1,"username":"username2","password":null,"first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":3,"role_id":1,"username":"username3","password":null,"first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_course_user.10.responsebody=[{"id":1,"role_id":1,"username":"username1","password":null,"first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":2,"role_id":1,"username":"username2","password":null,"first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":3,"role_id":1,"username":"username3","password":null,"first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_course_user.10.responsestatus=200
                
                test_course_user.11.uri=/[^/]*/courses/\\d+/users
                test_course_user.11.method=post
                test_course_user.11.requestbody=[{"id":999,"role_id":1,"username":"invalid_username","password":"newpassword","first_name":"Invalid","last_name":"User","email":"invalid_username@ubc.ca","student_id":"00000000"}]
                test_course_user.11.responsestatus=500
                
                test_course_user.20.uri=/[^/]*/courses/1/users/1
                test_course_user.20.method=delete
                test_course_user.20.responsestatus=204
                
                test_course_user.21.uri=/[^/]*/courses/1/users/999
                test_course_user.21.method=delete
                test_course_user.21.responsestatus=500
                
                test_group_user.1.uri=/[^/]*/groups/\\d+/users
                test_group_user.1.method=get
                test_group_user.1.responsebody=[{"id":1,"role_id":1,"username":"username1","first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":2,"role_id":1,"username":"username2","first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":3,"role_id":1,"username":"username3","first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_group_user.1.responsestatus=200
                
                test_group_user.2.uri=/[^/]*/groups/999/users
                test_group_user.2.method=get
                test_group_user.2.responsestatus=500
                
                test_group_user.10.uri=/[^/]*/groups/\\d+/users
                test_group_user.10.method=post
                test_group_user.10.requestbody=[{"id":1,"role_id":1,"username":"username1","password":null,"first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":2,"role_id":1,"username":"username2","password":null,"first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":3,"role_id":1,"username":"username3","password":null,"first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_group_user.10.responsebody=[{"id":1,"role_id":1,"username":"username1","password":null,"first_name":"Test","last_name":"User1","email":"username1@ubc.ca","student_id":"12345671"}, {"id":2,"role_id":1,"username":"username2","password":null,"first_name":"Test","last_name":"User2","email":"username2@ubc.ca","student_id":"12345672"},{"id":3,"role_id":1,"username":"username3","password":null,"first_name":"Test","last_name":"User3","email":"username3@ubc.ca","student_id":"12345673"}]
                test_group_user.10.responsestatus=200
                
                test_group_user.11.uri=/[^/]*/groups/\\d+/users
                test_group_user.11.method=post
                test_group_user.11.requestbody=[{"id":999,"role_id":1,"username":"invalid_username","password":"newpassword","first_name":"Invalid","last_name":"User","email":"invalid_username@ubc.ca","student_id":"00000000"}]
                test_group_user.11.responsestatus=500
                
                test_group_user.20.uri=/[^/]*/groups/1/users/1
                test_group_user.20.method=delete
                test_group_user.20.responsestatus=204
                
                test_group_user.21.uri=/[^/]*/groups/1/users/999
                test_group_user.21.method=delete
                test_group_user.21.responsestatus=500
                
                test_event.1.uri=/[^/]*/courses/\\d+/events
                test_event.1.method=get
                test_event.1.responsebody=[{"id":1,"course_id":1,"title":"eventname1","description":"","self_eval":1,"due_date":"2012-10-30T16:43:12","release_date_begin":"2012-09-30T16:43:11","release_date_end":"2012-10-30T16:43:11"}, {"id":2,"course_id":1,"title":"eventname2","description":"","self_eval":1,"due_date":"2012-10-30T16:43:11","release_date_begin":"2012-09-30T16:43:11","release_date_end":"2012-10-30T16:43:11"}, {"id":3,"course_id":1,"title":"eventname3","description":"","self_eval":1,"due_date":"2012-10-30T16:43:11","release_date_begin":"2012-09-30T16:43:11","release_date_end":"2012-10-30T16:43:11"}]
                test_event.1.responsestatus=200
                
                test_event.2.uri=/[^/]*/courses/999/events
                test_event.2.method=get
                test_event.2.responsestatus=500
                
                test_event.11.uri=/[^/]*/courses/\\d+/events/999
                test_event.11.method=get
                test_event.11.responsestatus=500
                
                test_event.10.uri=/[^/]*/courses/\\d+/events/1
                test_event.10.method=get
                test_event.10.responsebody={"id":1,"course_id":1,"title":"eventname1","description":"","self_eval":1,"due_date":"2012-10-30T16:43:12","release_date_begin":"2012-09-30T16:43:11","release_date_end":"2012-10-30T16:43:11"}
                test_event.10.responsestatus=200
                
                test_event.20.uri=/[^/]*/users/1/events
                test_event.20.method=get
                test_event.20.responsebody=[{"id":1,"course_id":1,"title":"eventname1","description":"","self_eval":1,"due_date":"2012-10-30T16:43:12","release_date_begin":"2012-09-30T16:43:11","release_date_end":"2012-10-30T16:43:11"}, {"id":2,"course_id":1,"title":"eventname2","description":"","self_eval":1,"due_date":"2012-10-30T16:43:11","release_date_begin":"2012-09-30T16:43:11","release_date_end":"2012-10-30T16:43:11"}, {"id":3,"course_id":1,"title":"eventname3","description":"","self_eval":1,"due_date":"2012-10-30T16:43:11","release_date_begin":"2012-09-30T16:43:11","release_date_end":"2012-10-30T16:43:11"}]   
                test_event.20.responsestatus=200
                
   				test_event.21.uri=/[^/]*/users/999/events
                test_event.21.method=get
                test_event.21.responsestatus=500
                
                test_grade.1.uri=/[^/]*/events/1/grades
                test_grade.1.method=get
                test_grade.1.responsebody=[{"id":1,"grade":10.5,"event_id":1,"event_title":"Test Event","user_id":1}, {"id":2,"grade":10.6,"event_id":1,"event_title":"Test Event","user_id":2},{"id":3,"grade":10.7,"event_id":1,"event_title":"Test Event","user_id":3}]
                test_grade.1.responsestatus=200
                
                test_grade.2.uri=/[^/]*/events/999/grades
                test_grade.2.method=get
                test_grade.2.responsestatus=500
                
                test_grade.10.uri=/[^/]*/events/1/grades/1
                test_grade.10.method=get
                test_grade.10.responsebody={"id":1,"grade":10.5,"event_id":1,"event_title":"Test Event","user_id":1}
                test_grade.10.responsestatus=200
                
                test_grade.11.uri=/[^/]*/events/1/grades/999
                test_grade.11.method=get
                test_grade.11.responsestatus=500
                
                test_grade.12.uri=/[^/]*/events/999/grades/1
                test_grade.12.method=get
                test_grade.12.responsestatus=500
                
                test_intg_course.1.uri=/[^/]*/courses
                test_intg_course.1.method=post
                test_intg_course.1.requestbody={"id":0,"course":"test","title":"test"}
                test_intg_course.1.responsebody={"id":1,"course":"testt","title":"test"}
                test_intg_course.1.responsestatus=201
            </value>
        </property>
        <property name="contentType" ref="jsonContentType" />
    </bean>
    
    <bean id="jsonContentType" class="org.springframework.http.MediaType">
        <constructor-arg value="application"/>
        <constructor-arg value="json"/>
    </bean>
    
    <bean id="servletHolder" class="org.eclipse.jetty.servlet.ServletHolder">
        <constructor-arg ref="courseApiServlet"/>
    </bean>
    
    <bean id="servletHandler" class="org.eclipse.jetty.servlet.ServletContextHandler"/>
	
	<!-- Adding the servlet holders to the handlers -->
	<bean id="servletHandlerSetter" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject" ref="servletHandler"/>
		<property name="targetMethod" value="addServlet"/>
		<property name="arguments">
			<list>
	    		<ref bean="servletHolder"/>
	    		<!-- <value>#{ T(ca.ubc.ctlt.ipeerb2.webservice.iPeerWebService).API_COURSE }/*</value> -->
	    		<value>/*</value>
	   		</list>
	 	</property>
	</bean>
	
	<bean id="httpTestServer" class="org.eclipse.jetty.server.Server" init-method="start" destroy-method="stop" depends-on="servletHandlerSetter">
	    <property name="connectors">
	        <list>
	            <bean class="org.eclipse.jetty.server.bio.SocketConnector">
	                <!-- <property name="host" value="localhost" /> -->
	                <property name="port" value="#{settings['webservice.server.port']}" />
	            </bean>
	        </list>
	    </property>

	    <property name="handler">
	    	<ref bean="servletHandler" />
	    </property>
	</bean>
</beans>